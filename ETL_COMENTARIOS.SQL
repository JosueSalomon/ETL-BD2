CREATE OR REPLACE PROCEDURE ETL_COMENTARIOS AS
    V_FECHA_INICIO DATE;
    V_FECHA_FIN DATE := TRUNC(SYSDATE); -- Fecha actual
    V_HORA_INICIO_PROCESO DATE := SYSDATE;
BEGIN
    EXECUTE IMMEDIATE 'TRUNCATE TABLE C##DWH.TBL_COMENTARIOS';
    
    SELECT MIN(FECHA_COMENTARIO) INTO V_FECHA_INICIO FROM TBL_COMENTARIOS_ARCHIVOS;
    IF V_FECHA_INICIO IS NULL THEN
        DBMS_OUTPUT.PUT_LINE('No hay datos para procesar.');
        RETURN;
    END IF;
    
    WHILE V_FECHA_INICIO <= V_FECHA_FIN LOOP
    
    DELETE FROM C##DWH.TBL_COMENTARIOS
    WHERE TRUNC(FEHCA_COMENTARIO) =TRUNC(V_FECHA_INICIO);
    
    INSERT INTO C##DWH.TBL_COMENTARIOS(
        ID_COMENTARIO,
        ID_ARCHIVO,
        ID_USAURIO,
        COMENTARIO,
        FEHCA_COMENTARIO
    )
    SELECT ID_COMENTARIO, ID_ARCHIVO,ID_USUARIO,COMENTARIO, FECHA_COMENTARIO
    FROM TBL_COMENTARIOS_ARCHIVOS
     WHERE TRUNC(FECHA_COMENTARIO) =TRUNC(V_FECHA_INICIO);
     COMMIT;
         V_FECHA_INICIO := V_FECHA_INICIO + 1;
    END LOOP;
END ETL_COMENTARIOS;

BEGIN
    ETL_COMENTARIOS;
END;


SELECT * FROM TBL_COMENTARIOS_ARCHIVOS;